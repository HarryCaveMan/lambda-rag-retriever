ARG PY_VER=3.12
FROM public.ecr.aws/lambda/python:$PY_VER

ARG EMBEDDING_API_ENDPOINT='https://api.openai.com/v1/embeddings'
ENV EMBEDDING_API_ENDPOINT=$EMBEDDING_API_ENDPOINT
ARG EMBEDDING_API_KEY
ENV EMBEDDING_API_KEY=$EMBEDDING_API_KEY
ARG EMBEDDING_API_MODEL='text-embedding-3-small'
ENV EMBEDDING_API_MODEL=$EMBEDDING_API_MODEL
ARG MODEL_DIM='1536'
ENV MODEL_DIM=$MODEL_DIM
ARG DATA_S3_BUCKET='brdge'
ENV DATA_S3_BUCKET=$DATA_S3_BUCKET

COPY requirements.txt ${LAMBDA_TASK_ROOT}

RUN pip install -r ${LAMBDA_TASK_ROOT}/requirements.txt

COPY *.py ${LAMBDA_TASK_ROOT}

CMD [ "service.handler" ]